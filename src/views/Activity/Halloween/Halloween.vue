<style src="./style.css"></style>
<template>
<div class="por" style="padding-top:30px" id="halloween">
	<img src="@/assets/halloween/gui.gif" id="gui" alt="" />
	
	<svg width="1920.0000000000002" height="1083" xmlns="http://www.w3.org/2000/svg" id="path">
	<g id="Layer_1">
	<polyline stroke-linecap="round" id="svg_1" points="-57.721572082756325,808.1202416109567 -57.721572082756325,810.6518871589044 -53.92410376083467,813.1835327068524 -50.12663543891301,816.9810010287737 -42.5316987950697,823.3101148986434 -28.607648281356944,829.6392287685127 -7.088661123800904,835.9683426383822 18.227794355676792,841.0316337342776 46.075895383102306,844.8291020561994 78.98728750642329,848.626570378121 109.36703408179653,848.626570378121 143.54424897909144,848.626570378121 177.72146387638637,847.360747604147 205.56956490381185,843.5632792822255 230.88602038328958,839.7658109603038 251.13918476687172,835.9683426383822 271.39234915045387,830.9050515424868 292.91133630801,825.841760446591 316.96196901351374,819.5126465767216 341.0126017190176,811.9177099328783 362.5315888765736,804.322773289035 384.05057603412973,795.4620138712177 403.037917643738,785.3354316794268 427.08855034924176,776.4746722616096 452.40500582871954,762.5506217478969 478.98728408217113,749.8923940081579 508.1012078835705,734.7025207204713 534.6834861370221,718.2468246588106 558.734118842526,704.322774145098 578.987283226108,689.1329008574114 596.7088020617425,672.6772047957509 611.8986753494291,653.6898631861426 624.5569030891679,635.9683443505082 633.4176625069852,619.5126482888477 641.0125991508285,606.8544205491089 646.0758902467239,591.6645472614223 648.6075357946718,576.4746739737357 651.1391813426197,562.550623460023 652.4050041165933,546.0949273983624 654.936649664541,528.373408562728 656.2024724385151,511.91771250106746 657.468295212489,496.72783921338083 661.2657635344106,480.2721431517204 665.0632318563323,465.0822698640338 668.8607001782539,449.89239657634715 672.6581685001757,435.96834606263434 677.7214595960712,419.5126500009739 685.3163962399144,403.05695393931336 691.6455101097838,390.3987261995744 699.2404467536272,375.20885291188785 706.8353833974704,362.550625172149 715.6961428152878,351.15822020638404 722.025256685157,339.7658152406191 729.6201933290004,328.3734102748541 735.9493071988697,319.51265085703693 742.2784210687394,309.38606866524583 752.4050032605303,299.25948647345473 763.7974082262954,290.39872705563755 777.7214587400081,281.5379676378203 791.6455092537208,273.943030993977 808.1012053153813,263.81644880218596 828.3543696989636,254.9556893843687 846.0758885345979,248.62657551449936 867.5948756921539,241.03163887065602 890.3796856236838,233.43670222681274 914.4303183291877,228.37341113091713 934.68348271277,223.3101200350216 954.9366470963521,218.24682893912606 975.1898114799342,215.7151833911783 990.3796847676207,213.1835378432305 1006.8353808292813,211.91771506925664 1020.759431342994,210.65189229528278 1030.8860135347852,209.38606952130885 1041.0125957265764,209.38606952130885 1051.1391779183673,209.38606952130885 1065.0632284320802,209.38606952130885 1080.2531017197668,209.38606952130885 1100.506266103349,210.65189229528278 1119.493607712957,211.91771506925664 1143.544240418461,213.1835378432305 1167.5948731239648,213.1835378432305 1191.6455058294687,213.1835378432305 1215.6961385349725,213.1835378432305 1242.278416788424,210.65189229528278 1268.8606950418757,206.85442397336112 1291.6455049734057,203.05695565143944 1314.4303149049358,197.9936645555439 1341.012593158387,192.93037345964837 1365.063225863891,187.86708236375284 1389.1138585693946,182.80379126785726 1409.3670229529769,179.0063229459356 1424.5568962406635,175.20885462401392 1438.4809467543764,170.14556352811846 1452.4049972680891,166.34809520619677 1466.3290477818018,162.55062688427512 1480.2530982955145,157.48733578837957 1492.9113260352533,153.6898674664579 1506.8353765489662,149.89239914453626 1518.227781514731,146.0949308226146 1530.8860092544699,141.03163972671905 1544.8100597681826,135.96834863082353 1554.936641959974,130.90505753492798 1565.0632241517649,124.57594366505856 1575.189806343556,118.24682979518911 1584.050565761373,113.18353869929359 1592.9113251791903,106.85442482942415 1603.0379073709814,101.7911337335286 1613.1644895627726,94.19619708968528 1620.759426206616,86.60126044584197 1629.620185624433,80.27214657597256 1638.4809450422501,71.41138715815535 1646.0758816860935,62.55062774033817 1653.670818329937,53.689868322520965 1663.797400521728,43.56328613072989 1671.3923371655712,34.702526712912686 1678.9872738094145,24.5759445211216 1685.316387679284,15.715185103304407 1691.6455015491533,6.8544256854872 1697.974615419023,0.5253118156177692 1703.0379065149184,-7.0696248282255425 1706.83537483684,-13.39873869809496 1709.367020384788,-18.46202979399051 1713.1644887067096,-23.52532088988605 1715.6961342546572,-29.854434759755478 1718.227779802605,-34.917725855651014 1725.8227164464483,-19.72785256796439 1729.6201847683697,-0.7405109583561112 1737.2151214122132,25.84176729509548 1749.8733491519522,56.22151387046872 1763.7973996656647,81.53796934994645 1770.1265135355343,105.58860205545028 1770.1265135355343,124.57594366505856 1770.1265135355343,132.17088030890187 1768.8606907615604,133.43670308287574 1768.8606907615604,132.17088030890187 1772.6581590834821,130.90505753492798 1780.2530957273254,127.10758921300632 1786.5822095971946,124.57594366505856 1790.3796779191164,122.04429811711076 1796.708791788986,122.04429811711076 1805.569551206803,122.04429811711076 1815.6961333985944,122.04429811711076 1820.7594244944896,122.04429811711076 1822.0252472684635,122.04429811711076 1824.5568928164114,120.7784753431369 1828.3543611383332,118.24682979518911 1835.9492977821762,114.44936147326746 1844.8100571999937,108.12024760339804 1851.1391710698626,101.7911337335286 1854.9366393917846,96.72784263763306 1857.4682849397325,89.13290599378976 1858.7341077137064,81.53796934994645 1861.2657532616543,75.208855480077 1861.2657532616543,66.34809606225983 1865.0632215835756,58.753159418416516 1866.3290443575495,49.89240000059931 1868.8606899054973,41.0316405827821 1870.1265126794713,33.43670393893879 1871.3923354534452,27.107590069069374 1872.658158227419,22.044298973173824 1873.923981001393,18.246830651252168 1875.1898037753667,15.715185103304407 1875.1898037753667,14.449362329330512 1876.455626549341,11.917716781382753 1876.455626549341,10.651894007408856 1876.455626549341,9.386071233434976 1876.455626549341,8.120248459461095 1876.455626549341,6.8544256854872 1876.455626549341,5.58860291151332 1877.7214493233143,5.58860291151332 1877.7214493233143,4.322780137539439 1878.9872720972883,4.322780137539439 1878.9872720972883,3.0569573635655445 1880.2530948712622,3.0569573635655445 1880.2530948712622,0.5253118156177692 1881.5189176452361,-0.7405109583561112 1881.5189176452361,-2.006333732329992 1881.5189176452361,-3.2721565063038867 1881.5189176452361,-4.537979280277767 1882.78474041921,-7.0696248282255425 1884.0505631931837,-9.601270376173304 1885.3163859671577,-12.132915924121077 1886.582208741132,-14.664561472068852 1889.1138542890797,-17.196207020016615 1890.3796770630536,-19.72785256796439 1891.6454998370275,-22.259498115912166 1892.911322611001,-24.791143663859927 1894.1771453849747,-26.05696643783382 1894.1771453849747,-27.322789211807702 1894.1771453849747,-28.588611985781583 " opacity="NaN" stroke="#000" fill="none"/>
	</g>
	</svg>
	<div id="bg1"></div>
	<div class="animation">
		<!-- <img id="ng2" src="@/assets/halloween/nangua2-idle.gif" alt="" height="100"/> -->
		<!-- <img src="@/assets/halloween/nangua3-idle.gif" alt=""/> -->
		<!-- <img id="ng" src="@/assets/halloween/nangua-idle.gif" alt="" height="100"/> -->
		<img id="zhizhu" src="@/assets/halloween/zhizhu-pa.gif" alt=""/>
	</div>
	<div class="tac por" style="padding-bottom: 50px">
		<h1 style="font-size: 50px;color:#FC8915;line-height:40px" class="t1">{{$t("Festival_01").toLocaleUpperCase()}}</h1>
		<h2 style="font-size: 40px;color:#AFD53D" class="t2">{{$t("Festival_32").toLocaleUpperCase()}}</h2>
		<div style="font-size:26px">
			<template  v-if="1636430400 - nowTs > 0">
				<p class="vertical-children">
					<span>{{$t("Festival_33")}}</span>
					<img class="mgl-10 cur-point" @click="getRootRefs().ruleDialog.show('MOMO_58','Festival_02')" src="@/assets/icon/help.png" alt="" height="30">
				</p>
				<p class="time vertical-children">
					<span>{{getLeftTime(1636430400 - nowTs).split(":")[0]}}</span> :
					<span>{{getLeftTime(1636430400 - nowTs).split(":")[1]}}</span> :
					<span>{{getLeftTime(1636430400 - nowTs).split(":")[2]}}</span> 
				</p>
			</template>
			<p v-else class="mgt-10 ">{{$t("Festival_37")}}</p>
		</div>
		<!-- 开箱子 -->
		<section class="mgt-30" id="data-view-p">
			<div class="hpanel por">
				<img id="ng" src="@/assets/halloween/nangua-idle.gif" alt="" height="130"/>
				<img id="ng2" src="@/assets/halloween/nangua2-idle.gif" alt="" height="130"/>

				<div id="data-view">
					<div id="data-view-panel" class="tal">
						<div class="aveage-box " v-for="item in ovdata" :key="item.type">
							<div>
								<p class="small opa-6">{{ovTypeToName[item.types][0]}}</p>
								<p style="font-size: 20px" class="bold">{{item.cnt}}</p>
							</div>
							
							<div>
								<p class="small opa-6">{{ovTypeToName[item.types][1]}}</p>
								<p style="font-size: 20px" class="bold">{{item.amount}}</p>
							</div>
							
						</div>
						<img id="data-box" src="@/assets/halloween/box.png" alt="" width="300">
					</div>
					<div class="mgt-10 small opa-6 tac">*{{$t("Festival_38")}}</div>
				</div>
				<section class="tac ovh"  style="max-width: 800px;margin:0px auto;padding: 20px 0px">
					<div class="col-md-7" id="rateshow">
						<div v-for="item in rateData" :key="item.lv" class="vertical-children dib" style="margin:5px 10px">
							<div style="height:20px;width:20px;border-radius:20px;padding:2px;" class="dib dot-bg">
								<div style="width:100%;height:100%;border-radius:20px;border:2px solid #1B1C21" :class="`bg-new${item.lv}`"></div>
							</div>
							<p class="dib mgl-5">{{item.rate}}</p>
						</div>
					</div>
					<div class="col-md-5" id="open-btn-view">
						<div class="btn-halloween por" @click="$refs.openbox.show()">
							<span class="num-notice" v-if="myData.box > 0">{{myData.box}}</span>
							{{$t("Festival_09")}}
						</div>
					</div>
				</section>
			</div>
		</section>
		<!-- 兑换操作 -->
		<section class="mgt-30">
			<div class="hpanel">
				<div id="data-view" style="padding:16px" class="por">
					<Tab :list="tabList" :defaultSelectPos="tabPos" :onChange="onTabChange" id="pc-tab" />
					<div class="new-mobile-tab hide">
						<Dropdown :list="tabList" :defaultSelectPos="last" :onChange="onTabChange" />&nbsp;
					</div>
					<div class="vertical-children tar" id="take-balance" v-if="tabPos == 0 || tabPos == 1">
						<img src="@/assets/coin/MBOX.png" alt="" height="24">
						<span class="mgl-10">{{numFloor(myData.balance, 1e2)}}</span>
						<div class="btn-halloween2 mgl-10" style="position:relative;right:-2px" @click="claimMbox">{{$t("Festival_17")}}</div>
					</div>
					<div id="selectDay" v-if="tabPos == 2">
						<Dropdown :list="[$t('Festival_29'),$t('Festival_30')]" :defaultSelectPos="last" :onChange="(pos)=>{last = pos;getDrank()}" />&nbsp;
					</div>

					<!-- 礼物兑换 -->
					<div v-if="tabPos == 0 || tabPos == 1" class="center-view">
						<div class="aveage-box mgt-20" >
							<div class="g-item por" v-for="item in itemCfg.slice(0,5)" :key="item.key" @click="selectItme(item)">
								<div class="por dib">
									<img class="por" style="z-index:10" :src="require(`@/assets/halloween/itembg${item.lv}.png`)" alt="" width="120">
									<div v-if="item.isSelect" class="g-item-active animate__animated  animate__pulse animate__infinite"></div>
								</div>
								<img class="g-item-icon" :src="require(`@/assets/halloween/${item.key}.png`)" alt="" width="120">
								<p class="g-item-num">×{{item.num}}</p>
								<p class="g-item-price vertical-children" v-if="tabPos == 1">
									<img src="@/assets/coin/MBOX.png" alt="" height="20" />
									<span class="mgl-5">{{item.price}}</span>
								</p>
							</div>
						</div>
						<div class="aveage-box mgt-30" >
							<div class="g-item por" v-for="item in itemCfg.slice(5,10)" :key="item.key" @click="selectItme(item)">
								<div class="por dib">
									<img class="por" style="z-index:10" :src="require(`@/assets/halloween/itembg${item.lv}.png`)" alt="" width="120">
									<div v-if="item.isSelect" class="g-item-active animate__animated  animate__pulse animate__infinite"></div>
								</div>
								<img class="g-item-icon" :src="require(`@/assets/halloween/${item.key}.png`)" alt="" width="120">
								<p class="g-item-num">×{{item.num}}</p>
								<p class="g-item-price vertical-children" v-if="tabPos == 1">
									<img src="@/assets/coin/MBOX.png" alt="" height="20" />
									<span class="mgl-5">{{item.price}}</span>
								</p>
							</div>
						</div>
					</div>
					<div v-if="tabPos == 2 || tabPos == 3">
						<div class="mgt-20" style="font-size:26px">
							<!-- <p class="dib hide-xs" v-if="tabPos == 2">{{$t("Festival_28")}}</p> -->
							<p class="time vertical-children dib mgl-10" >
								<span>{{getLeftTime(cntDown).split(":")[0]}}</span> :
								<span>{{getLeftTime(cntDown).split(":")[1]}}</span> :
								<span>{{getLeftTime(cntDown).split(":")[2]}}</span>
							</p>
						</div>
						<table style="width: 100%" class="new-table mgt-20">
							<tr class="opa-6">
								<th class="tal " style="width: 33%"> {{ $t("Rank_05") }}</th>
								<th class="tac tac-xs" style="width: 33%">{{$t("Festival_31")}}</th>
								<th class="tar tac-xs" style="padding-right:20px">{{$t("Festival_27")}}</th>
							</tr>
						
							<tr v-for="item in rankData.slice( 10 * (rankPage - 1), 10 * rankPage )" :key="item.rank">
								<td class="tal">
									<span class="dib tac rank-icon" :class="{active: item.rank <= 3}">{{ item.rank }}</span >
									<span style="margin-left: 10px">
										{{ shorAddress(item.addr) }}
									</span>
								</td>
								<td class="tac vertical-children tac-xs">
									<img src="@/assets/halloween/lg.png" alt="" width="20">&nbsp;
									<span class="mgl-5">{{item.score}}</span>
								</td>
								<td class="tar vertical-children">
									<span style="width: 100px" class="dib tal tac-xs mgt-5">
										<img src="@/assets/coin/CRYSTAL.png" alt="" width="20">&nbsp;
										<span class="dib tal mgl-5"> {{item.reward.mec}}</span>
									</span>
									<span v-if="tabPos == 3 && item.rank < 3" style="width: 100px" class="dib tac mgt-5">
										<!-- <img src="@/assets/pet/60005.gif" alt="" width="30"> -->
										<PetItemMin :data="momoDatas[item.rank]" :isLeft="true" />
									</span>
									<span style="width: 100px" class="dib tal tac-xs mgt-5" v-else>
										<img src="@/assets/coin/MBOX.png" class="mgl-20" alt="" width="20">&nbsp;
										<span class="dib tal mgl-5"> {{item.reward.mbox}}</span>
									</span>
								</td>
							</tr>
							<tr v-if="rankData.length > 1">
								<td colspan="4" style="border:none">
									<div class="mgt-10"></div>
									<Page :defaultPage="rankPage" :totalPage="Math.ceil(rankData.length / 10)" :onChange="onPageChange" ref="page" />
								</td>
							</tr>
							
							<tbody class="my-rank">
							<tr >
								<td class="tal" style="border-top-left-radius:12px;border-bottom-left-radius:12px">
									<span class="dib tac rank-icon" :class="{active: meRankData.rank <= 3}">{{ meRankData.rank || "-" }}</span >
									<span style="margin-left: 20px"> {{ shorAddress(meRankData.addr) }} </span>
								</td>
								<td class="tac vertical-children tac-xs">
									<img src="@/assets/halloween/lg.png" alt="" width="20">&nbsp;
									<span class="mgl-5">{{meRankData.score || 0}}</span>
								</td>
								<td class="tar vertical-children" style="border-top-right-radius:12px;border-bottom-right-radius:12px" >
									<template v-if="meRankData.reward.mec || meRankData.reward.mbox">
										<span style="width: 100px" class="dib tal tac-xs mgt-5">
											<img src="@/assets/coin/CRYSTAL.png" alt="" width="20">&nbsp;
											<span class="dib tal mgl-5"> {{meRankData.reward.mec}}</span>
										</span>
										<span v-if="tabPos == 3 && meRankData.rank < 3" style="width: 100px" class="dib tac mgt-5">
											<PetItemMin :data="momoDatas[meRankData.rank]" :isLeft="true" :isTop="true" />
										</span>
										<span style="width: 100px" class="dib tal tac-xs mgt-5" v-else>
											<img src="@/assets/coin/MBOX.png" class="mgl-20" alt="" width="20">&nbsp;
											<span class="dib tal mgl-5"> {{meRankData.reward.mbox}}</span>
										</span>
									</template>
									<span v-else>-</span>
								</td>

							</tr>
						</tbody>

						</table>
					</div>
				</div>
				<div v-if="tabPos == 0" style="padding: 20px 0px" id="exchange-view">
					<div class="center-view aveage-box" id="exchange-opr">
						<div class="tal" style="border-right: 1px solid #363078" id="my-score">
							<p>{{$t("Festival_22")}}:</p>
							<div class="vertical-children mgt-10">
								<img src="@/assets/halloween/lg.png" alt="" height="37">
								<span class="mgl-5" style="font-size:28px">{{myData.score}}</span>
							</div>
						</div>
						<div class="tal" style="flex:2;padding-left:30px" id="selectsute">
							<p>{{$t("Festival_18")}}:</p>
							<div class="mgt-210">
								<Dropdown :list="suteData" :defaultSelectPos="sutePos" :onChange="onSelectSuteChange" />&nbsp;
								<span class="mgl-10">{{$t("Festival_20").replace("#0#",getMaxSute)}}</span>
							</div>
						</div>
						<div class="tac" id="exchange-btn">
							<div class="vertical-children">
								<img class="mgl-5" src="@/assets/coin/MBOX.png" height="24" alt="">
								<span class="mgl-5">{{suitPrices[sutePosToId[sutePos]]}}</span>
								<img class="mgl-10" src="@/assets/halloween/lg.png" alt="" height="24">
								<span class="mgl-5" >{{suitScore[sutePosToId[sutePos]]}}</span>
							</div>
							<div class="mgt-10">
								<div class="btn-halloween tac" @click="goExchange">{{$t("Festival_21")}}</div>
							</div>
						</div>
					</div>
				</div>
				<div v-if="tabPos == 1" style="padding: 20px;padding-top:10px">
					<div class="btn-halloween3 mgt-10" @click="sell(1)">{{$t("Festival_25")}}</div>
					<div class="btn-halloween mgl-20 mgt-10" @click="sell('all')">{{$t("Festival_26")}}</div>
				</div>
			</div>
		</section>
		<!-- 操作记录 -->
		<section class="mgt-30" v-if="tabPos == 0 || tabPos == 1">
			<div class="hpanel" style="padding: 16px">
				<table class="small  new-table hide-xs" border="0" frame="void" rules="none" >
					<tr>
						<th width="20%" class="tal tac-xs">{{ $t("BOX_12") }}</th>
						<th width="20%" class="tal">{{ $t("BOX_26") }}</th>
						<th width="20%" class="tal">{{$t("Air-drop_50")}}</th>
						<th width="30%" class="tal">{{$t("Festival_27")}}</th>
						<th width="10%" class="tar">TX</th>
					</tr>
					<tr v-for="item in oprLogs" :key="item.tx">
						<td class="tal tac-xs">{{ dateFtt("yyyy-MM-dd hh:mm:ss" , new Date(item.ts * 1000)) }}</td>
						<td class="tal">
							<!-- <span >{{item.types}}</span> -->
							<span v-if="item.types == 2">{{$t("Festival_14")}}</span>
							<span v-if="item.types == 3">{{$t("Festival_13")}}</span>
							<span v-if="item.types == 4">{{$t("Festival_09")}}</span>
							<span v-if="item.types == 5">{{$t("Festival_17")}}</span>
						</td>
						<td class="tal">
							<span v-if="item.types == 5">-</span>
							<span v-else>x{{item.num}}</span>
						</td>
						<td class="tal">
							<span v-if="item.types == 4" >-</span>
							<span v-else class="vertical-children">
								<template v-if="Number(item.mbox) > 0">
									<span style="width: 100px" class="dib">
										<img src="@/assets/coin/MBOX.png" alt="" height="20">
										<span  class="mgl-5">{{item.mbox}}</span>
									</span>
								</template>
								<template v-if="Number(item.score) > 0">
									<img  class="mgl-10" src="@/assets/halloween/lg.png" alt="" height="20">
									<span  class="mgl-5">{{item.score}}</span>
								</template>
							</span>
						</td>
						<td class="tar">
							<img v-if="item.types != 5"  @click="viewDetail = item.detail; showDetail= true" src="@/assets/icon/view.png" height="25" alt="" class="cur-point" />&nbsp;
							<a :href="getTxUrl(item.tx)" target="_blank" v-if="item.tx != null">
								<img src="@/assets/icon/viewTx.png" alt="" height="25" class="cur-point" />
							</a>
						</td>
					</tr>
				</table>
				<div id="mobile-list" class="hide">
					<div v-for="item in oprLogs" :key="item.tx" class="mobile-list-item">
						<div class="aveage-box">
							<p class="tal">
								<span v-if="item.types == 2">{{$t("Festival_14")}}</span>
								<span v-if="item.types == 3">{{$t("Festival_13")}}</span>
								<span v-if="item.types == 4">{{$t("Festival_09")}}</span>
								<span v-if="item.types == 5">{{$t("Festival_17")}}</span>
								<span class="mgl-5">
									<span v-if="item.types != 5">x{{item.num}}</span>
								</span>
							</p>
							<p class="tar" style="flex: 2">
								<span v-if="item.types == 4" >-</span>
								<span v-else class="vertical-children">
									<template v-if="Number(item.mbox) > 0">
										<span style="width: 100px" class="dib">
											<img src="@/assets/coin/MBOX.png" alt="" height="20">
											<span  class="mgl-5">{{item.mbox}}</span>
										</span>
									</template>
									<template v-if="Number(item.score) > 0">
										<img  class="mgl-10" src="@/assets/halloween/lg.png" alt="" height="20">
										<span  class="mgl-5">{{item.score}}</span>
									</template>
								</span>
							</p>
						</div>
						<div class="aveage-box mgt-10">
							<p class="tal opa-6">{{ dateFtt("yyyy-MM-dd hh:mm:ss" , new Date(item.ts * 1000)) }}</p>
							<p class="tar">
								<img v-if="item.types != 5"  @click="viewDetail = item.detail; showDetail= true" src="@/assets/icon/view.png" height="25" alt="" class="cur-point" />&nbsp;
								<a :href="getTxUrl(item.tx)" target="_blank" v-if="item.tx != null">
									<img src="@/assets/icon/viewTx.png" alt="" height="25" class="cur-point" />
								</a>
							</p>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
	<div id="view-detail" v-if="showDetail" @click="showDetail = false">
		<div id="view-detail-cont" class="aveage-box">
			<div class="aveage-box ">
				<div class="g-item por" v-for="item in viewDetail.slice(0,5)" :key="item.gid" >
					<div class="por dib">
						<img class="por" style="z-index:10" :src="require(`@/assets/halloween/itembg${itemCfg[item.gid -1].lv}.png`)" alt="" width="120">
					</div>
					<img class="g-item-icon" :src="require(`@/assets/halloween/${item.gid}.png`)" alt="" width="120">
					<p class="g-item-num">×{{item.num}}</p>
				</div>
			</div>
			<div class="aveage-box mgt-20" v-if="viewDetail.length > 5">
				<div class="g-item por" v-for="item in viewDetail.slice(5,5)" :key="item.gid" >
					<div class="por dib">
						<img class="por" style="z-index:10" :src="require(`@/assets/halloween/itembg${itemCfg[item.gid -1].lv}.png`)" alt="" width="120">
					</div>
					<img class="g-item-icon" :src="require(`@/assets/halloween/${item.gid}.png`)" alt="" width="120">
					<p class="g-item-num">×{{item.num}}</p>
				</div>
			</div>

		</div>
	</div>
	<OpenBox ref="openbox" :myData = "myData" />
	<Exchange ref="exchange" :exchangeData = "{maxNum: getMaxSute, suteId: sutePosToId[sutePos]}" />
</div>
</template>

<script>
import { Tab, Page, Dropdown, PetItemMin } from '@/components';
import CommonMethod from '@/mixin/CommonMethod';
import OpenBox from './OpenBox'
import Exchange from './Exchange'
import { Wallet } from '@/utils';
import axios from 'axios';
import { HttpConfig } from "@/config";
import { mapState } from 'vuex';

const $ = window.$;
let timer = null;

const baseAttr = {
	num: 1,
	level: 1,
	vType: 6,
	quality: 6,
	chain: "bnb",
	category: 5,
	speciality: 2,
	hashrate: 180,
	gems: [0,0,0,0],
	lvHashrate: 180,
	location: "Wallet",
	noPrice: true
}

export default {
	mixins: [CommonMethod],
	components: {Tab, Page, OpenBox, Dropdown, Exchange, PetItemMin},
	data(){
		return ({
			momoDatas: [0,
				{...baseAttr, tokenId: 0, prototype: 60007, tokenName: "Name_347",round: 1},
				{...baseAttr, tokenId: 0, prototype: 60001, tokenName: "Name_241",round: 2},
			],
			tabList: [this.$t("Festival_13"), this.$t("Festival_14"),this.$t("Festival_15"),this.$t("Festival_16")],
			tabPos: 0,
			rateData: [
				{lv: 1, rate: "72.94%"},
				{lv: 2, rate: "20%"},
				{lv: 3, rate: "6%"},
				{lv: 4, rate: "1%"},
				{lv: 5, rate: "0.05%"},
				{lv: 6, rate: "0.01%"},
			],
			itemCfg: [
				{key:1,lv: 1, num: 0, res: "",price: 0.13, isSelect: false},{key:2,lv: 1, num: 0, res: "",price: 0.13, isSelect: false},
				{key:3,lv: 2, num: 0, res: "",price: 0.24, isSelect: false},{key:4,lv: 2, num: 0, res: "",price: 0.24, isSelect: false},
				{key:5,lv: 3, num: 0, res: "",price: 0.8, isSelect: false},{key:6,lv: 3, num: 0, res: "",price: 0.8, isSelect: false},
				{key:7,lv: 4, num: 0, res: "",price: 2, isSelect: false},{key:8,lv: 4, num: 0, res: "",price: 2, isSelect: false},
				{key:9,lv: 5, num: 0, res: "",price: 201.2, isSelect: false},{key:10,lv: 6, num: 0, res: "",price: 800, isSelect: false},
			],
			suitPrices: { 4: 1.88, 6: 5.88, 8: 15.88, 9: 518.88, 10: 2518.88 },
			suitScore: { 4: 1, 6: 3, 8: 10, 9: 400, 10: 2500 },
			rankData: [],
			meRankData: {
				"rank": 0,
				"reward": {
					"mbox": 0,
					"mec": 0
				},
				"score": 0,
				"addr": ""
			},
			rankPage: 1,
			myAddr: "",
			myData: {
				"score": 0,
				"box": 0,
				"balance": 0
			},
			suteData: [
				this.$t("Festival_19").replace("#0#", 1).replace("#1#",': 1').replace("#2#",4),
				this.$t("Festival_19").replace("#0#", 2).replace("#1#",': 1').replace("#2#",6),
				this.$t("Festival_19").replace("#0#", 3).replace("#1#",': 1').replace("#2#",8),
				this.$t("Festival_19").replace("#0#", 4).replace("#1#",': 1').replace("#2#",9),
				this.$t("Festival_19").replace("#0#", 5).replace("#1#",': 1').replace("#2#",10),
				],
			sutePos: 4,
			sutePosToId: [4,6,8,9,10],
			last: 0,
			cntDown: 0,
			ovdata: [
				{"types": 1,"cnt": 0,"amount": 0},
				{"types": 2,"cnt": 0,"amount": 0},
				{"types": 3,"cnt": 0,"amount": 0},
			],
			ovTypeToName: {
				1: [this.$t("Festival_03"), this.$t("Festival_04")],
				2: [this.$t("Festival_05"), this.$t("Festival_06")],
				3: [this.$t("Festival_07"), this.$t("Festival_08")],
			},
			oprLogs: [],
			viewDetail: [ { "gid": "1", "num": 15 }, { "gid": "2", "num": 20 }, { "gid": "3", "num": 3 }, { "gid": "4", "num": 7 }, { "gid": "5", "num": 1 }, { "gid": "6", "num": 1 }, { "gid": "7", "num": 1 }, { "gid": "8", "num": 2 } ],
			showDetail: false,
		})
	},
	computed: {
		...mapState({
			nowTs: (state) => state.globalState.data.nowTs,
		}),
		getMaxSute(){
			let num = 100000000;
			this.itemCfg.map(item=>{
				if(item.isSelect && num > item.num){
					num = item.num;
				}
			});
			return num
		}
	},
	watch: {
		sutePos: function(value){
			this.setSuteSelect(value);
		},
		nowTs: async function(ts){
			if(this.cntDown > 0) this.cntDown--;

			if(ts % 10 == 0){
				await this.getMyData();
				await this.getOvData();
			}
		}
	},
	async created(){
		this.setSuteSelect(this.sutePos)
		this.myAddr = await Wallet.ETH.getAccount();
		await this.getMyData();
		await this.getOvData();
		await this.getOprLogs();
	},
	mounted(){
		this.moveSvg();
	},
	beforeDestroy(){
		clearInterval(timer);
	},
	methods: {
		moveSvg(){
			let STEP = 500;
			let curStep = 0;
			let path = $('#svg_1')[0];
			let $gui = $('#gui');
			let totalLength = path.getTotalLength();
			let initPosition = path.getPointAtLength(0);
			// let prePosition = initPosition;
			let curPosition = initPosition;

			$gui.css({
				left: initPosition.x,
				top:initPosition.y,
				// '-webkit-transform': 'translate(-2px, 0) rotate(' + this.getRotate(curPosition , path.getPointAtLength(1)) +'deg)'
			}).show()

			timer = setInterval(() => {
				if (curStep != STEP) {
					curStep++;
					curPosition = path.getPointAtLength(totalLength/STEP * curStep);

					$gui.css({
						left: curPosition.x,
						top:curPosition.y,
						// '-webkit-transform': 'translate(-2px, 0) rotate('+this.getRotate(prePosition, curPosition)+'deg)'
					}).show();
					// prePosition = curPosition;
				}else{
					clearInterval(timer);
				}
			}, 100)

		},
		getRotate(a, b) {
			var k = (b.y - a.y) / (b.x - a.x);
			var rotate = Math.atan(k) * 180 / Math.PI;
			return k < 0 ? rotate + 90 : rotate - 90;
		},
		async getSign(){
			let now = Math.floor(Date.now() / 3600000);
			let str = "momo_event_" + now;
			console.log(str);
			let signStr =  await Wallet.ETH.signStr(str);
			return signStr
		},
		async getOprLogs(){
			let res = await axios.post(HttpConfig.Halloween.Logs, {addr: this.myAddr});
			if(res.data.code == 200){
				this.oprLogs = res.data.data;
			}
		},
		async getOvData(){
			let res = await axios.post(HttpConfig.Halloween.Ovdata, {addr: this.myAddr});
			if(res.data.code == 200){
				this.ovdata = res.data.data;
			}
		},
		goExchange(){
			if(this.getMaxSute <= 0){
				this.showNotify(this.$t("Festival_34"), 'error')
			}else{
				this.$refs.exchange.show();
			}
		},
		async getDrank(){
			let data = {
				addr: this.myAddr,
				last: this.last,
			}
			let res = await axios.post(HttpConfig.Halloween.Drank, data);
			if(res.data.code == 200){
				this.rankData = res.data.data.rank;
				this.meRankData = res.data.data.me;
				this.cntDown = res.data.data.cntDown;
			}
		},
		async getTrank(){
			let data = {
				addr: this.myAddr,
			}
			let res = await axios.post(HttpConfig.Halloween.Trank, data);
			if(res.data.code == 200){
				this.rankData = res.data.data.rank;
				this.meRankData = res.data.data.me;
				this.cntDown = res.data.data.cntDown;
			}
		},
		async claimMbox(){
			let amount = Number(this.myData.balance);
			if(!(amount >= 5 && 1636430400 - this.nowTs > 0)){
				this.getConfirmDialog().show(this.$t("Festival_39"), null, true);
				return;
			}
			let sign = await this.getSign();

			let data = {
				addr: this.myAddr,
				sign,
				amount
			}
			let res = await axios.post(HttpConfig.Halloween.Claim, data);
			console.log(res);
			if(res.data.code == 200){
				this.getConfirmDialog().show(this.$t("Festival_36"), null, true);

				this.getMyData();
				this.getOprLogs();
			}
		},
		onSelectSuteChange(pos){
			this.sutePos = pos;
		},
		async sell(num){
			let targetItem;
			this.itemCfg.map(item=>{
				if(item.isSelect) targetItem = item;
			});
			if(num == "all") num = targetItem.num;
			if(targetItem.num == 0) {
				this.showNotify(this.$t("Festival_34"), "error");
				return;
			}

			let sign = await this.getSign();

			let data = {
				addr: this.myAddr,
				sign,
				gid: targetItem.key,
				num,
			}
			let res = await axios.post(HttpConfig.Halloween.Sell, data);
			if(res.data.code == 1011){
				this.showNotify(this.$t("Festival_34"), "error");
			}else{
				this.setBagsData(res.data.data);
			}
		},
		setSuteSelect(value){
			this.itemCfg.map(item=>{
				item.isSelect = (value == 0 && item.key < 5) 
					|| (value == 1 && item.key < 7)
					|| (value == 2 && item.key < 9)
					|| (value == 3 && item.key < 10)
					|| (value == 4 && item.key < 11)
			});
		},
		selectItme(item){
			if(this.tabPos == 1){
				this.itemCfg.map(item=>{
					item.isSelect = false;
				});
				item.isSelect = true
			}
		},
		async getMyData(){
			let res = await axios.post(HttpConfig.Halloween.Bags, {addr: this.myAddr});
			if(res.status == 200){
				this.setBagsData(res.data.data);
			}
		},
		setBagsData(data){
			let {score, box ,balance, bags} = data;
			this.myData.score = score;
			this.myData.box = box;
			this.$store.commit("userState/setData", {halloweenBox: box});
			this.myData.balance = balance;
			bags.map(item=>{
				this.itemCfg[item.gid - 1].num = item.num;
			});
			this.getOprLogs();
		},
		onTabChange(pos){
			this.tabPos = pos;

			if(pos == 1){
				this.selectItme(this.itemCfg[0])
			}
			if(pos == 0){
				this.setSuteSelect(this.sutePos)
			}
			if(pos == 2){
				this.rankPage = 1;
				this.getDrank();
			}
			if(pos == 3){
				this.rankPage = 1;
				this.getTrank();
			}
			this.$nextTick(()=>{
				this.$refs.page && this.$refs.page.initPage();
			})
		},
		onPageChange(page){
			this.rankPage = page;
		}
	}
}
</script>

<style >
	#data-view li.active{
		background: #6d5df3 !important;
	}
	#data-view li{
		color: #fff;
	}
	.hpanel .new-table{
		background: none !important
	}
	.hpanel .my-rank{
		background: #161331;
	}
	.hpanel .new-table td{
		/* border: 1px solid red; */
	}
	#halloween .yf-dialog{
		background: #161331;
		border-radius: 12px;
		border: 3px solid #211d42;
	}
	#halloween .ly-input{
		background: rgba(255, 255, 225, 0.1);
	}
	#halloween .dropdown .dropdown-value{
		background: #6d5df3;
		width: 150px;
		color: #fff
	}
	#halloween .dropdown .dropdown-list{
		background: #4b4679;
		width: 150px;
		color: #fff
	}
	#halloween .dropdown .dropdown-list li.active{
		background: #6d5df3 !important;
		color: #fff
	}
	#halloween .dropdown .dropdown-list li:hover{
		background: #6d5df3 !important;
		color: #fff
	}
	#selectDay .dropdown .dropdown-value{
		border-start-end-radius: 0px;
		border-end-end-radius: 0px;
	}
	#selectDay{
		position: absolute;
		right: 0px;
	}
</style>
